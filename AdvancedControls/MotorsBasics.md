# How do Motors Actually Work?

## We know how to control motors, and it's been vaguely described using "Voltage", but how does voltage affect a motor?

At this point, you should be familiar with some of the control methods for motors, but the controller's outputs have been expressed arbitrarily like u(t). 

There are two important electrical values that actually make the motor turn: **voltage** (measured in **Volts**)  and **current** (also called **amperage**/measured in **Amps**). The voltage is (roughly) proportional to the **speed** of the motor. I.e., the more voltage sent to the motor, the faster it goes. The current is (roughly) proportional to the **acceleration** of the motor. If you haven't taken physics, acceleration is the change in velocity over time: how quickly the speed is changing (and speed is how quickly the position is changing). Note that these have **directions**, so acceleration can be both slowing down or speeding up. 

What does this actually mean? If you're currently giving the motor 10 Volts, and you want to give it 8 Volts, it can't make that change instantaneously: it requires some current to make that change. 10 Volts to 8 Volts is relatively small, so it will only draw a little bit more current. If you want to go from 10 Volts to -10 Volts, however (a change of 20 Volts), it's going to draw a LOT of current, because it's a much **larger** change (over the same/similar time interval). If we can't provide enough current and we max out (usually around 40 Amps), it will take more time to make the change. This itself requires controls, but we won't worry about that since it's all tuned by the manufacturer. 

It's important to note that our battery always gives out (roughly) 12V. There's no way to actually give the motors less voltage since there will always be 12V flowing through the wires. So motor controllers use a fancy sounding thing called **Pulse Width Modulation (PWM)**. PWM gives "pulses" of voltage to the motor. When I say "pulse", I mean it turns the motors on and off at 12V rapidly. To be more specific, say we want to run the motors at 6V, half the battery voltage. We can only give the motors 12V at a time, so we instead only turn it on half the time. Specifically, we might turn the motor on (give it 12V) for one second, and then turn it off (give it 0V) for one second (in reality it wouldn't be one second, it would be a tiny tiny fraction of a second). So, half the time it's on, half the time it's off, and this (roughly) equates to giving it 6V. The percentage of the time a motor is 'turned on' is called the **Duty Cycle**. For the situation I just described, the duty cycle would be 50%. The approximate "Applied Voltage" = Duty Cycle * Battery Voltage. So if we want an applied voltage of 3V, we use a duty cycle of 25% on our 12V battery: .25 * 12 = 3. Controlling the sign (positive or negative) of the voltage is completely separate and is just as simple (conceptually, not physically) as switching which direction the electricity flows in.

All of this is handled by our **motor controller**. Falcon motors have one integrated within the motor, and NEOs use a SparkMAX motor controller. The motor controller communicates with the robot and handles giving power to the motors, and talking to the sensors on the motor. It works like this: the code sends the motor controller a signal: "hey! how fast is the motor turning right now?" and the motor controller reads the sensor in the motor, and reports back to the code. Then the code sends another signal "Set the motor to 5V", and then the motor controller responds by setting the proper duty cycle and letting power through to the motor. The motor controller also typically has its own controller, for regulating current and even for running something like PID loops. While telling the controller to set the motor to 5V is one option, there are typically many options like "make the motor turn at 2000RPM" or "turn the motor to 15 degrees", provided you give it the proper tuning constants. These on-board control loops can often run quicker (more adjustments per second), making them slightly more precise than running them with the code and then feeding it a desired voltage.

**An important note:** Almost ALL of what I just described gives you an intuitive understanding of what's going on, NOT what's really happening in the circuit. Electricity is complicated and there are a lot of fine details I glossed over. I'm sure physicists everywhere are cringing at my explanation of it all, but intuitively that's what's going on.

### Resources (All Optional)

- Read [this article](https://www.magneticinnovations.com/faq/dc-motor-how-it-works/#:~:text=When%20the%20motor%20is%20powered,the%20motor%20has%20a%20commutator.) for a brief explanation about what makes motors turn
- Watch [this video](https://www.youtube.com/watch?v=GQatiB-JHdI&ab_channel=TheEngineeringMindset) for a detailed but (relatively) simple explanation of how motors work under the hood.
- More in-depth [article](https://www.monolithicpower.com/en/brushless-vs-brushed-dc-motors) on what BLDC motors are/how they work
- For some more technical explanations of how to control a BLDC motor, you can read [this](https://www.mathworks.com/campaigns/offers/brushless-dc-motors-introduction.html), [this](https://www.mathworks.com/help/sps/ug/bldc-speed-control.html), or [this](https://www.mathworks.com/help/sps/ug/brushless-dc-motor.html) article from MATLAB
